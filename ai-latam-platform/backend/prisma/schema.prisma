// Prisma Schema for AI Latam Platform
// 数据库: Supabase PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==================== Tools 表 ====================
// 字段说明:
// - id: 主键，自增
// - name: 工具名称，必填
// - tag: 标签，必填（如 "AI工具", "效率工具"）
// - category: 分类，可选（如 "图像生成", "文本写作"）
// - description: 工具描述，可选
// - price: 价格信息，可选（如 "免费", "$9.99/月"）
// - url: 工具链接，可选
// - affiliate_link: 联盟链接，可选
// - logo_url: Logo 图片 URL，可选
// - image_url: 展示图片 URL，可选
// - is_featured: 是否为推荐工具，默认 false
// - created_at: 创建时间，默认当前时间

model Tool {
  id             Int      @id @default(autoincrement())
  name           String   @unique
  tag            String
  category       String?
  description    String?
  price          String?
  url            String?
  affiliateLink  String?  @map("affiliate_link")
  logoUrl        String?  @map("logo_url")
  imageUrl       String?  @map("image_url")
  gallery        Json?    @map("gallery")
  isFeatured     Boolean  @default(false) @map("is_featured")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([tag])
  @@index([category])
  @@index([isFeatured])
  @@index([createdAt])
  @@map("tools")
}

// ==================== Prompts 表 ====================
// 字段说明:
// - id: 主键，自增
// - title: 提示词标题，必填
// - category: 分类，必填（如 "写作", "编程"）
// - platforms: 支持的平台列表，必填（JSON 数组）
// - preview: 预览文本，可选
// - prompt: 完整提示词内容，必填
// - created_at: 创建时间，默认当前时间

model Prompt {
  id         Int      @id @default(autoincrement())
  title      String   @unique
  category   String
  platforms  Json     // 存储 ["ChatGPT", "Claude", "Midjourney"]
  preview    String?
  prompt     String   @db.Text
  coverImage String?  @map("cover_image")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([category])
  @@index([createdAt])
  @@map("prompts")
}

// ==================== Posts 表 ====================
// 字段说明:
// - id: 主键，自增
// - title: 文章标题，必填
// - excerpt: 摘要，可选
// - tag: 标签，可选（如 "深度测评", "提示词拆解"）
// - readTime: 阅读时间，可选（如 "5 Min Read"）
// - publishedAt: 发布日期，必填
// - content: 文章内容，可选（长文本）
// - sourceUrl: 原文链接，可选
// - createdAt: 创建时间，默认当前时间

model Post {
  id           Int      @id @default(autoincrement())
  title        String
  excerpt      String?
  tag          String?
  readTime     String?  @map("read_time")
  publishedAt  DateTime @default(now()) @map("published_at")
  content      String?  @db.Text
  sourceUrl    String?  @map("source_url")
  coverImage   String?  @map("cover_image")
  gallery      Json?    @map("gallery")
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([tag])
  @@index([publishedAt])
  @@index([createdAt])
  @@map("posts")
}

// ==================== Papers 表 ====================
// 字段说明:
// - id: 主键，自增
// - title: 论文标题，必填
// - slug: URL 友好的唯一标识符，必填，唯一
// - authors: 作者列表，必填（JSON 数组）
// - summary: 简短摘要，可选（用于列表展示）
// - abstract: 论文摘要，可选（长文本）
// - venue: 会议/期刊，可选
// - year: 发表年份，可选
// - tags: 研究方向标签，必填（JSON 数组）
// - pdfUrl: PDF 链接，可选
// - codeUrl: 代码仓库链接，可选
// - projectUrl: 项目页链接，可选
// - coverImage: 论文封面图，可选
// - publishedAt: 发布日期，默认当前时间
// - createdAt: 创建时间，默认当前时间

model Paper {
  id         Int      @id @default(autoincrement())
  title      String
  arxivId    String   @unique @map("arxiv_id")
  slug       String   @unique
  authors    Json
  summary    String?  @db.Text
  abstract   String?  @db.Text
  venue      String?
  year       Int?
  primaryCategory String? @map("primary_category")
  tags       Json
  pdfUrl     String?  @map("pdf_url")
  codeUrl    String?  @map("code_url")
  projectUrl String?  @map("project_url")
  coverImage String?  @map("cover_image")
  publishedAt DateTime @default(now()) @map("published_at")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([year])
  @@index([primaryCategory])
  @@index([publishedAt])
  @@index([createdAt])
  @@map("papers")
}

// ==================== Learning_Notes 表 ====================
// 字段说明:
// - id: 主键，自增
// - title: 笔记标题，必填，唯一
// - slug: URL 友好的唯一标识符，必填，唯一
// - category: 分类，必填（如 "提示词工程", "智能体", "RAG"）
// - summary: 摘要，可选（用于列表展示）
// - tags: 标签数组，必填（JSON 数组，用于检索和筛选）
// - cover_image: 封面图片 URL，可选
// - content: Markdown 内容，必填（长文本，存储完整文章）
// - order_index: 排序索引，可选（用于拖拽排序）
// - updated_at: 最后更新时间，自动更新
// - created_at: 创建时间，默认当前时间

model LearningNote {
  id         Int      @id @default(autoincrement())
  title      String   @unique
  slug       String   @unique
  category   String
  summary    String?  @db.Text
  tags       Json     // 存储 ["Few-shot", "CoT", "Self-Consistency"]
  coverImage String?  @map("cover_image")
  content    String   @db.Text
  orderIndex Int?     @map("order_index")
  updatedAt  DateTime @updatedAt @map("updated_at")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([category])
  @@index([orderIndex])
  @@index([updatedAt])
  @@index([createdAt])
  @@map("learning_notes")
}
